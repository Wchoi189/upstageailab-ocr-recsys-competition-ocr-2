{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Agent Framework State Schema",
  "description": "Schema for agent framework state tracking and persistence",
  "type": "object",
  "required": [
    "schema_version",
    "last_updated",
    "framework",
    "current_context",
    "sessions",
    "artifacts",
    "relationships",
    "statistics"
  ],
  "properties": {
    "schema_version": {
      "type": "string",
      "description": "Version of the state schema"
    },
    "last_updated": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of last state update"
    },
    "framework": {
      "type": "object",
      "required": ["name", "version"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Framework name"
        },
        "version": {
          "type": "string",
          "description": "Framework version"
        }
      }
    },
    "current_context": {
      "type": "object",
      "required": [
        "active_session_id",
        "current_branch",
        "current_phase",
        "active_artifacts",
        "pending_tasks"
      ],
      "properties": {
        "active_session_id": {
          "type": ["string", "null"],
          "description": "ID of the currently active session"
        },
        "current_branch": {
          "type": ["string", "null"],
          "description": "Current git branch"
        },
        "current_phase": {
          "type": ["string", "null"],
          "description": "Current project phase"
        },
        "active_artifacts": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "List of currently active artifact paths"
        },
        "pending_tasks": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "List of pending task identifiers"
        }
      }
    },
    "sessions": {
      "type": "object",
      "required": ["total_count", "active_session", "session_history"],
      "properties": {
        "total_count": {
          "type": "integer",
          "minimum": 0,
          "description": "Total number of sessions"
        },
        "active_session": {
          "type": ["string", "null"],
          "description": "ID of active session"
        },
        "session_history": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "List of session IDs in history"
        }
      }
    },
    "artifacts": {
      "type": "object",
      "required": ["total_count", "by_type", "by_status", "index"],
      "properties": {
        "total_count": {
          "type": "integer",
          "minimum": 0,
          "description": "Total number of artifacts"
        },
        "by_type": {
          "type": "object",
          "additionalProperties": {
            "type": "integer",
            "minimum": 0
          },
          "description": "Count of artifacts by type"
        },
        "by_status": {
          "type": "object",
          "additionalProperties": {
            "type": "integer",
            "minimum": 0
          },
          "description": "Count of artifacts by status"
        },
        "index": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/artifact"
          },
          "description": "Index of all artifacts"
        }
      }
    },
    "relationships": {
      "type": "object",
      "required": ["artifact_dependencies", "session_artifacts"],
      "properties": {
        "artifact_dependencies": {
          "type": "object",
          "additionalProperties": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "description": "Map of artifact to its dependencies"
        },
        "session_artifacts": {
          "type": "object",
          "additionalProperties": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "description": "Map of session ID to artifacts created in that session"
        }
      }
    },
    "statistics": {
      "type": "object",
      "required": [
        "total_sessions",
        "total_artifacts_created",
        "total_artifacts_validated",
        "total_artifacts_deployed",
        "last_session_timestamp"
      ],
      "properties": {
        "total_sessions": {
          "type": "integer",
          "minimum": 0,
          "description": "Total number of sessions across history"
        },
        "total_artifacts_created": {
          "type": "integer",
          "minimum": 0,
          "description": "Total number of artifacts created"
        },
        "total_artifacts_validated": {
          "type": "integer",
          "minimum": 0,
          "description": "Total number of artifacts validated"
        },
        "total_artifacts_deployed": {
          "type": "integer",
          "minimum": 0,
          "description": "Total number of artifacts deployed"
        },
        "last_session_timestamp": {
          "type": ["string", "null"],
          "format": "date-time",
          "description": "Timestamp of last session"
        }
      }
    }
  },
  "definitions": {
    "artifact": {
      "type": "object",
      "required": ["path", "type", "status", "created_at", "last_updated", "metadata"],
      "properties": {
        "path": {
          "type": "string",
          "description": "Path to the artifact file"
        },
        "type": {
          "type": "string",
          "description": "Type of artifact (e.g., implementation_plan, assessment)"
        },
        "status": {
          "type": "string",
          "enum": ["draft", "in_progress", "validated", "deployed", "deprecated"],
          "description": "Current status of the artifact"
        },
        "created_at": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp of artifact creation"
        },
        "last_updated": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp of last update"
        },
        "metadata": {
          "type": "object",
          "description": "Additional metadata for the artifact"
        }
      }
    }
  }
}
