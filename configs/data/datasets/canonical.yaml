# @package data

defaults:
  - /data/transforms/base@transforms
  - _self_

batch_size: 16

train_num_samples: null
val_num_samples: null
test_num_samples: null

# Dataset Definitions (Flattened)
train_dataset:
  _target_: ocr.data.datasets.ValidatedOCRDataset
  config:
    _target_: ocr.core.validation.DatasetConfig
    image_path: ${global.paths.datasets_root}/images/train
    annotation_path: ${global.paths.datasets_root}/jsons/train.json
    # Explicitly disable caching to prevent default override
    cache_config:
      _target_: ocr.core.validation.CacheConfig
      cache_transformed_tensors: false
      cache_images: false
      cache_maps: false
      log_statistics_every_n: null
  transform: ${data.transforms.train_transform}

val_dataset:
  _target_: ocr.data.datasets.ValidatedOCRDataset
  config:
    _target_: ocr.core.validation.DatasetConfig
    image_path: ${global.paths.datasets_root}/images_val_canonical  # Using canonical (rotation-corrected) data
    annotation_path: ${global.paths.datasets_root}/jsons/val.json
  transform: ${data.transforms.val_transform}

test_dataset:
  _target_: ocr.data.datasets.ValidatedOCRDataset
  config:
    _target_: ocr.core.validation.DatasetConfig
    image_path: ${global.paths.datasets_root}/images_val_canonical  # Using canonical (rotation-corrected) data
    annotation_path: ${global.paths.datasets_root}/jsons/val.json
  transform: ${data.transforms.test_transform}

predict_dataset:
  _target_: ocr.data.datasets.ValidatedOCRDataset
  config:
    _target_: ocr.core.validation.DatasetConfig
    image_path: ${global.paths.datasets_root}/images/test
    annotation_path: null
  transform: ${data.transforms.test_transform}

collate_fn:
  _target_: ocr.domains.detection.data.collate_db.DBCollateFN
  shrink_ratio: 0.4
  thresh_min: 0.3
  thresh_max: 0.7
