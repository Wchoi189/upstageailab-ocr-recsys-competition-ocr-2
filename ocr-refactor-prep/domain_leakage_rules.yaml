rules:
  - id: detect-recognition-leakage
    language: Python
    message: "Critical: Detection logic found inside Recognition context."
    rule:
      all:
        - pattern: "$$$" # Matches any block
        - has:
            pattern: "max_polygons" # Detection specific
        - has:
            pattern: "char_level"   # Recognition specific
    note: "This function is likely a [LEAKAGE: MULTI-DOMAIN] candidate."

  - id: detect-wandb-global-pollution
    language: Python
    message: "Violation: Domain-specific WandB logging inside common utils."
    rule:
      all:
        - pattern: "def $NAME($$$): $$$"
        - has:
            any:
              - pattern: 'wandb.log({ "detection/$_": $$$ })'
              - pattern: 'wandb.log({ "recognition/$_": $$$ })'
    note: "WandB logging must be moved to domain-specific callbacks."

  - id: improper-config-branching
    language: Python
    message: "Warning: String-based domain branching detected."
    rule:
      any:
        - pattern: 'if $CFG.domain == "detection": $$$'
        - pattern: 'if $CFG.type == "recognition": $$$'
    note: "This should be handled via Hydra polymorphism, not 'if' statements."
