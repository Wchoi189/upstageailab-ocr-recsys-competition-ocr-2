# @package _group_

# Standalone CRAFT data configuration

defaults:
  - /data/transforms/base@transforms
  - _self_

batch_size: 16

data:
  train_num_samples: null
  val_num_samples: null
  test_num_samples: null

dataset_base_path: "${global.paths.datasets_root}"

datasets:
  train_dataset:
    _target_: ${data.dataset_path}.ValidatedOCRDataset
    config:
      _target_: ${data.dataset_config_path}.DatasetConfig
      image_path: ${data.dataset_base_path}images/train
      annotation_path: ${data.dataset_base_path}jsons/train.json
    transform: ${data.transforms.train_transform}
  val_dataset:
    _target_: ${data.dataset_path}.ValidatedOCRDataset
    config:
      _target_: ${data.dataset_config_path}.DatasetConfig
      image_path: ${data.dataset_base_path}images_val_canonical  # Using canonical (rotation-corrected) data
      annotation_path: ${data.dataset_base_path}jsons/val.json
    transform: ${data.transforms.val_transform}
  test_dataset:
    _target_: ${data.dataset_path}.ValidatedOCRDataset
    config:
      _target_: ${data.dataset_config_path}.DatasetConfig
      image_path: ${data.dataset_base_path}images_val_canonical  # Using canonical (rotation-corrected) data
      annotation_path: ${data.dataset_base_path}jsons/val.json
    transform: ${data.transforms.test_transform}
  predict_dataset:
    _target_: ${data.dataset_path}.ValidatedOCRDataset
    config:
      _target_: ${data.dataset_config_path}.DatasetConfig
      image_path: ${data.dataset_base_path}images/test
      annotation_path: null
    transform: ${data.transforms.test_transform}

transforms:
  train_transform:
    _target_: ${dataset_path}.DBTransforms
    transforms:
      - _target_: albumentations.LongestMaxSize
        max_size: 768
        p: 1.0
      - _target_: albumentations.PadIfNeeded
        min_width: 768
        min_height: 768
        border_mode: 0
        p: 1.0
      - _target_: albumentations.RandomRotate90
        p: 0.5
      - _target_: albumentations.Normalize
        mean: [0.485, 0.456, 0.406]
        std: [0.229, 0.224, 0.225]
    keypoint_params:
      _target_: albumentations.KeypointParams
      format: 'xy'
      remove_invisible: True
  val_transform:
    _target_: ${dataset_path}.DBTransforms
    transforms:
      - _target_: albumentations.LongestMaxSize
        max_size: 768
        p: 1.0
      - _target_: albumentations.PadIfNeeded
        min_width: 768
        min_height: 768
        border_mode: 0
        p: 1.0
      - _target_: albumentations.Normalize
        mean: [0.485, 0.456, 0.406]
        std: [0.229, 0.224, 0.225]
    keypoint_params:
      _target_: albumentations.KeypointParams
      format: 'xy'
      remove_invisible: True
  test_transform:
    _target_: ${dataset_path}.DBTransforms
    transforms:
      - _target_: albumentations.LongestMaxSize
        max_size: 768
        p: 1.0
      - _target_: albumentations.PadIfNeeded
        min_width: 768
        min_height: 768
        border_mode: 0
        p: 1.0
      - _target_: albumentations.Normalize
        mean: [0.485, 0.456, 0.406]
        std: [0.229, 0.224, 0.225]
    keypoint_params:
      _target_: albumentations.KeypointParams
      format: 'xy'
      remove_invisible: True
  predict_transform:
    _target_: ${dataset_path}.DBTransforms
    transforms:
      - _target_: albumentations.LongestMaxSize
        max_size: 768
        p: 1.0
      - _target_: albumentations.PadIfNeeded
        min_width: 768
        min_height: 768
        border_mode: 0
        p: 1.0
      - _target_: albumentations.Normalize
        mean: [0.485, 0.456, 0.406]
        std: [0.229, 0.224, 0.225]
    keypoint_params: null

collate_fn:
  _target_: ${dataset_path}.CraftCollateFN
  region_blur_scale: 0.35
  affinity_kernel_ratio: 0.25
  affinity_blur_scale: 0.15
  min_text_area: 9
