decisions:
- id: dec_001
  decision: Refactor binning from fixed 45° angle quadrants to horizontal/vertical classification using abs(dx) > abs(dy)
  rationale: Fixed angle quadrants (45°-135° = Top) caused coordinate inversion in image space (Y increases downward). The new classification is coordinate-system agnostic and adapts to aspect ratios.
  impact: Eliminated all invalid_edge_angles failures. Algorithm now produces geometrically valid quadrilaterals for all 25 samples.
  timestamp: 2025-11-29 00:30 (KST)
  alternatives_considered:
    - Fix angle ranges to account for coordinate inversion
    - Use adaptive angle windows based on bounding box aspect ratio
    - Keep angle-based but swap Top/Bottom definitions

- id: dec_002
  decision: Use segment midpoint position relative to centroid for Top/Bottom/Left/Right classification
  rationale: After determining horizontal vs vertical via abs(dx) > abs(dy), use position (y < cy for Top, x < cx for Left) to avoid coordinate system confusion.
  impact: Robust binning that works correctly for both tall and wide documents without aspect ratio tuning.
  timestamp: 2025-11-29 00:30 (KST)
  alternatives_considered:
    - Use angle-based classification with corrected coordinate mapping
    - Use bounding box aspect ratio to adjust angle thresholds

- id: dec_003
  decision: Implement geometric synthesis approach instead of strict validation for regression-based fits
  rationale: Regression lines intentionally deviate from noisy masks (by design). Pixel-perfect validation (RMSE, edge support) creates a "validation paradox" where good regression fits are rejected. Geometric synthesis (intersection of fitted_quad and bbox_corners) trusts regression results while ensuring safe boundaries.
  impact: Achieved 100% success rate (25/25). Eliminated false rejections of valid regression fits. Outputs guaranteed to stay within bounding box limits.
  timestamp: 2025-11-29 01:09 (KST)
  alternatives_considered:
    - Relax validation thresholds (would still reject some valid fits)
    - Weighted regression by segment length (doesn't solve validation paradox)
    - Hybrid approach with partial validation (adds complexity without solving root issue)

- id: dec_004
  decision: Fix variable shadowing bug by renaming image dimensions to img_h, img_w
  rationale: Variables h and w were shadowed by bounding box unpacking (x, y, w, h = cv2.boundingRect(...)), causing geometric synthesis to receive bounding box dimensions instead of image dimensions. This created a canvas too small for image-space coordinates.
  impact: Fixed canvas size issue. Geometric synthesis now correctly uses full image dimensions, eliminating clipping/truncation artifacts.
  timestamp: 2025-11-29 02:15 (KST)
  alternatives_considered:
    - Use different variable names for bounding box (would require more refactoring)
    - Pass image dimensions as separate parameter (less clear than preserving original variables)
