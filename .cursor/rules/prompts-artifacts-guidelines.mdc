---
alwaysApply: true
---

# AI Agent Instructions - Cursor Rules

## üö® **CRITICAL**: Single Source of Truth

**READ THIS FILE FIRST**: `docs/agents/system.md`

This file contains ALL AI agent instructions, rules, and workflows. All other AI instruction files are deprecated.

## üö® **FORBIDDEN: Manual Artifact Creation**

**NEVER use `write` tool to create files in `artifacts/` or `docs/bug_reports/`.**

**ONLY use AgentQMS toolbelt or artifact_workflow.py script.**

**Manual creation bypasses validation and violates project rules.**

**Before using `write` tool, check if path is in artifact directory:**
```python
from agent_qms.toolbelt import check_before_write

# This will raise ManualCreationError if path is in artifacts/ or docs/bug_reports/
check_before_write("artifacts/assessments/my-file.md")  # ‚ùå Raises error
```

## üéØ **Quick Reference**

### **Artifact Creation**

**Preferred Method: Use AgentQMS Toolbelt**
```python
from agent_qms.toolbelt import AgentQMSToolbelt

toolbelt = AgentQMSToolbelt()
artifact_path = toolbelt.create_artifact(
    artifact_type="assessment",  # or "implementation_plan"
    title="My Artifact",
    content="## Summary\n...",
    author="ai-agent",
    tags=["tag1", "tag2"]
)
```

**Alternative: Legacy Artifact Workflow**
```bash
python scripts/agent_tools/core/artifact_workflow.py create --type [TYPE] --name [NAME] --title "[TITLE]"
```

**Available Types:**
- `implementation_plan` ‚Üí `artifacts/implementation_plans/` (includes Progress Tracker - Blueprint Protocol)
- `assessment` ‚Üí `artifacts/assessments/` (includes Progress Tracker for iterative work)
- `bug_report` ‚Üí `docs/bug_reports/` (AgentQMS-managed, requires bug ID generation)

**Progress Trackers:**
- **Required** for implementation plans (Blueprint Protocol Template)
- **Required** for assessments involving iterative debugging or incremental progress
- **Update** Progress Tracker after each task completion, blocker, or discovery

### **Tool Discovery**
```bash
# Direct discovery (recommended)
python scripts/agent_tools/core/discover.py

# List available tools
python scripts/agent_tools/core/discover.py --list

# Validate manifest
python scripts/agent_tools/documentation/validate_manifest.py
```

### **Tool Organization**
- `core/` - Essential automation tools (artifact creation, templates, discovery)
- `compliance/` - Validation and monitoring tools
- `documentation/` - Documentation management tools
- `utilities/` - Helper functions and context tools
- `maintenance/` - One-time fix scripts and migrations
- `ocr/` - OCR-specific tools

### **Bug Report Creation**

**‚ö†Ô∏è CRITICAL: Bug reports require bug ID generation before creation.**

**Bug Report Template Location:** `docs/bug_reports/BUG_REPORT_TEMPLATE.md` (reference template)

**Bug ID Generation:**
```bash
uv run python scripts/bug_tools/next_bug_id.py  # Generates BUG-YYYYMMDD-###
```

**Bug Report Location:** `docs/bug_reports/` (AgentQMS-managed)

**Preferred Method: Use AgentQMS Toolbelt**
```python
from agent_qms.toolbelt import AgentQMSToolbelt
import subprocess

# Generate bug ID first
bug_id = subprocess.check_output(
    ["uv", "run", "python", "scripts/bug_tools/next_bug_id.py"],
    text=True
).strip()

toolbelt = AgentQMSToolbelt()
artifact_path = toolbelt.create_artifact(
    artifact_type="bug_report",
    title="Bug Description",
    content="## Summary\n...",
    author="ai-agent",
    tags=["bug", "issue"],
    bug_id=bug_id,
    severity="High"
)
```

**Required Sections:**
- Summary, Environment, Steps to Reproduce
- Expected vs Actual Behavior, Root Cause Analysis
- Resolution, Testing, Prevention

### **File Format**
- **Naming**: Use AgentQMS naming conventions (semantic, not timestamp-based)
- **Frontmatter**: Required with title, date, type, category, status, version (validated against schema)
- **Directory**: Must match type prefix (`artifacts/implementation_plans/`, `artifacts/assessments/`, `docs/bug_reports/`)
- **Bug Reports**: Use `docs/bug_reports/` (AgentQMS-managed)

## üö´ **NEVER**
- Create files manually (use AgentQMS toolbelt!)
- Create files in project root
- Skip frontmatter
- Use spaces in filenames
- Use ALL CAPS filenames (except README.md, CHANGELOG.md, and bug report IDs like BUG-YYYYMMDD-###)
- Grep for bug report template (it's at `docs/bug_reports/BUG_REPORT_TEMPLATE.md`)
- Create bug reports without generating bug ID first

## ‚úÖ **ALWAYS**
- Use AgentQMS toolbelt for artifact creation (preferred)
- Include proper frontmatter (validated against schema)
- Follow naming conventions exactly (semantic, lowercase, kebab-case)
- Update indexes after creating files
- Validate before committing
- Keep intermediate summaries during development ultra concise
- **For bug reports**: Generate bug ID first (`uv run python scripts/bug_tools/next_bug_id.py`), then use AgentQMS toolbelt
- **If tools fail**: Try `python scripts/agent_tools/core/discover.py` to find available tools
- **For help**: Use `python scripts/agent_tools/core/artifact_workflow.py --help` (legacy) or see `docs/agents/protocols/governance.md`
- **Check quality**: Use `python scripts/agent_tools/documentation/validate_manifest.py`

## üìö **Documentation Structure**

- **AI Agent Instructions**: `docs/agents/` - Ultra-concise instructions
  - `system.md` - Single source of truth (READ FIRST)
  - `index.md` - Documentation map
  - `protocols/` - Concise protocols (development, components, configuration, governance)
  - `references/` - Quick reference (architecture, commands, tools)
- **Maintainer Documentation**: `docs/maintainers/` - Detailed documentation for humans
- **AgentQMS**: `agent_qms/` (root) - Framework for artifact creation

## üîó **Quick Links**

- **System Instructions**: `docs/agents/system.md`
- **Protocols**: `docs/agents/protocols/`
- **References**: `docs/agents/references/`
- **AgentQMS Usage**: `docs/agents/protocols/governance.md`
