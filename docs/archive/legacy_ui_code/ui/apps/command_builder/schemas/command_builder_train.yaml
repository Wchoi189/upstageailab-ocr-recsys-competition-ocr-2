title: "OCR Training Command Builder"

constant_overrides: []

ui_elements:
  - key: exp_name
    type: text_input
    label: "Experiment Name"
    default: "ocr_training"
    help: "A unique name for this experiment."
    hydra_override: "exp_name"
    validation:
      required: true
      min_length: 3

  - key: wandb
    type: checkbox
    label: "Use Weights & Biases"
    default: false
    hydra_override: "logger.wandb.enabled"

  - key: resume_training
    type: checkbox
    label: "Resume Training"
    default: false

  - key: checkpoint_path
    type: selectbox
    label: "Checkpoint Path"
    options_source: "checkpoints"
    default: ""
    visible_if: "resume_training == true"
    hydra_override: "resume"
    validation:
      required_if: "resume_training == true"

  - key: architecture
    type: selectbox
    label: "Architecture"
    options_source: "models.architectures"
    default: "dbnet"
    help: "OCR architecture preset (DBNet, CRAFT, DBNet++)."
    visible_if: "resume_training == false"
    hydra_override: "model/architectures"
    metadata_help_key: "notes"
    architecture_fallback: "dbnet"

  - key: architecture_components
    type: info
    label: "Component Summary"
    visible_if: "resume_training == false"
    metadata_info_key: "components"
    info_template: "Encoder: {encoder}\nDecoder: {decoder}\nHead: {head}\nLoss: {loss}"

  - key: encoder
    type: selectbox
    label: "Backbone (Encoder)"
    options_source: "models.backbones"
    default: "resnet18"
    help: "Backbone encoder architecture."
    visible_if: "resume_training == false"
    hydra_override: "model.encoder.model_name"
    filter_by_architecture_key: "compatible_backbones"
    metadata_default_key: "default_backbone"
    metadata_help_key: "compatible_backbones"

  - key: decoder
    type: selectbox
    label: "Decoder"
    options_source: "models.decoders"
    default: "unet"
    help: "Decoder to reconstruct feature maps into probability maps."
    visible_if: "resume_training == false"
    hydra_override: "model.component_overrides.decoder.name"
    filter_by_architecture_key: "compatible_decoders"
    metadata_default_key: "default_decoder"
    metadata_help_key: "compatible_decoders"

  - key: head
    type: selectbox
    label: "Head"
    options_source: "models.heads"
    default: "db_head"
    help: "Detection head producing probability and threshold maps."
    visible_if: "resume_training == false"
    hydra_override: "model.component_overrides.head.name"
    filter_by_architecture_key: "compatible_heads"
    metadata_default_key: "default_head"
    metadata_help_key: "compatible_heads"

  - key: loss
    type: selectbox
    label: "Loss"
    options_source: "models.losses"
    default: "db_loss"
    help: "Loss function used for optimisation."
    visible_if: "resume_training == false"
    hydra_override: "model.component_overrides.loss.name"
    filter_by_architecture_key: "compatible_losses"
    metadata_default_key: "default_loss"
    metadata_help_key: "compatible_losses"

  - key: optimizer
    type: selectbox
    label: "Optimizer"
    options_source: "models.optimizers"
    default: "adam"
    help: "Optimizer preset to load into the model configuration."
    visible_if: "resume_training == false"
    hydra_override: "model/optimizers"
    filter_by_architecture_key: "recommended_optimizers"
    metadata_default_key: "default_optimizer"
    metadata_help_key: "recommended_optimizers"

  - key: learning_rate
    type: slider
    label: "Learning Rate"
    min_value: 1.0e-5
    max_value: 1.0e-2
    default: 1.0e-3
    step: 1.0e-5
    format: "%.1e"
    hydra_override: "model.optimizer.lr"
    validation:
      required: true
    metadata_default_key: "default_learning_rate"
    optimizer_metadata_key: "learning_rate"
    optimizer_help_key: "learning_rate.help"

  - key: weight_decay
    type: slider
    label: "Weight Decay"
    min_value: 0.0
    max_value: 0.01
    default: 0.0001
    step: 0.0001
    format: "%.4f"
    hydra_override: "model.optimizer.weight_decay"

  - key: batch_size
    type: slider
    label: "Batch Size"
    min_value: 1
    max_value: 64
    default: 4
    step: 1
    hydra_override:
      - "dataloaders.train_dataloader.batch_size"
      - "dataloaders.val_dataloader.batch_size"
    validation:
      required: true
      min: 1

  - key: max_epochs
    type: slider
    label: "Max Epochs"
    min_value: 1
    max_value: 200
    default: 10
    step: 1
    hydra_override: "trainer.max_epochs"

  - key: accumulate_grad_batches
    type: slider
    label: "Gradient Accumulation"
    min_value: 1
    max_value: 16
    default: 1
    step: 1
    hydra_override: "trainer.accumulate_grad_batches"

  - key: gradient_clip_val
    type: slider
    label: "Gradient Clip Value"
    min_value: 0.0
    max_value: 10.0
    default: 5.0
    step: 0.5
    hydra_override: "trainer.gradient_clip_val"

  - key: precision
    type: selectbox
    label: "Trainer Precision"
    options:
      - "32"
      - "bf16"
      - "bf16-mixed"
      - "16-mixed"
    default: "32"
    hydra_override: "trainer.precision"

  - key: seed
    type: number_input
    label: "Random Seed"
    default: 42
    min_value: 0
    hydra_override: "seed"

  - key: dataset
    type: selectbox
    label: "Dataset Config"
    options_source: "datasets"
    default: "default"
    help: "Hydra dataset configuration to load. Note: This will be automatically set to 'preprocessing' if you select a preprocessing profile below."
    visible_if: "resume_training == false"
    hydra_override: "data"
    metadata_default_key: "recommended_data"

  - key: preprocessing_profile
    type: selectbox
    label: "Preprocessing Profile"
    options:
      - label: "None (standard transforms)"
        value: "none"
      - label: "Lens-style (balanced)"
        value: "lens_style"
      - label: "Lens-style + Office mode"
        value: "lens_style_office"
      - label: "CamScanner document detection"
        value: "camscanner"
      - label: "docTR demo (experimental)"
        value: "doctr_demo"
    default: "none"
    help: "Microsoft Lens-style preprocessing with document detection, perspective correction, and enhancement. When selected, 'data=preprocessing' will be used automatically."
    visible_if: "resume_training == false"
