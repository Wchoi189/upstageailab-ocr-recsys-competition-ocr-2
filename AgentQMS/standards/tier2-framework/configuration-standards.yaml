---
ads_version: "1.0"
type: rule_set
title: Configuration Handling Standards
agent: all
tier: 2
priority: critical
validates_with: "AgentQMS/standards/schemas/compliance-checker.py"
compliance_status: unknown
memory_footprint: 300
date: "2025-12-27"
status: active
id: configuration-handling
description: >-
  Standards for safely handling OmegaConf configuration objects to prevent
  silent failures from invalid type checks.

rules:
  - id: no-isinstance-dict
    severity: critical
    description: >-
      NEVER use `isinstance(obj, dict)` on objects that might be configurations.
      OmegaConf's DictConfig does not inherit from dict.
    bad_patterns:
      - "isinstance(cfg, dict)"
      - "if type(cfg) is dict:"
    good_patterns:
      - "from ocr.core.utils.config_utils import is_config; is_config(cfg)"

  - id: use-is-config
    severity: critical
    description: >-
      ALWAYS use `ocr.core.utils.config_utils.is_config(obj)` to check for
      dictionary-like config objects.
    example: |
      from ocr.core.utils.config_utils import is_config
      if is_config(cfg):
          process(cfg)

  - id: use-ensure-dict
    severity: critical
    description: >-
      ALWAYS use `ocr.core.utils.config_utils.ensure_dict(obj)` when you need a
      native Python dictionary.
    bad_patterns:
      - "dict(cfg)"
      - "OmegaConf.to_container(cfg)"
    good_patterns:
      - "ensure_dict(cfg)"
    example: |
      from ocr.core.utils.config_utils import ensure_dict
      native_dict = ensure_dict(cfg)

utilities:
  - name: is_config
    signature: "is_config(obj: Any) -> TypeGuard[dict | DictConfig]"
    description: Returns True if object is dict or DictConfig.

  - name: ensure_dict
    signature: "ensure_dict(cfg: Any, resolve: bool = True) -> dict | list | Any"
    description: >-
      Recursively converts OmegaConf objects to native Python types.
      resolve=True handles variable interpolation.
