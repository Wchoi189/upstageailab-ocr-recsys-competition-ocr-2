# @package _global_

dataset_base_path: "${hydra:runtime.cwd}/data/datasets/"

batch_size: 4

data:
  train_num_samples: null
  val_num_samples: null
  test_num_samples: null

datasets:
  train_dataset:
    _target_: ${dataset_path}.ValidatedOCRDataset
    config:
      _target_: ${dataset_config_path}.DatasetConfig
      image_path: ${dataset_base_path}images/train
      annotation_path: ${dataset_base_path}jsons/train.json
      enable_background_normalization: false  # Disabled for training to avoid augmentation conflicts
    transform: ${transforms.train_transform}
  val_dataset:
    _target_: ${dataset_path}.ValidatedOCRDataset
    config:
      _target_: ${dataset_config_path}.DatasetConfig
      # PERFORMANCE OPTIMIZATION: Canonical validation images path
      # Uses pre-processed images optimized for validation (consistent EXIF handling)
      # Required for reproducible benchmarks and cache consistency
      image_path: ${dataset_base_path}images_val_canonical
      annotation_path: ${dataset_base_path}jsons/val.json
      enable_background_normalization: false  # Disabled for validation to match training

      # PERFORMANCE PRESET SYSTEM (2025-10-14)
      # Use performance presets to easily toggle optimization features
      # Available presets in configs/data/performance_preset/:
      #   - none: No optimizations (default, safe for all use cases)
      #   - minimal: No optimizations (same as none, for clarity)
      #   - balanced: Image caching only (~1.12x speedup)
      #   - validation_optimized: Full caching (~2.5-3x speedup, validation only!)
      #   - memory_efficient: Minimal memory footprint
      #
      # Usage: uv run python runners/train.py data/performance_preset=balanced
      # Default: none (no performance optimizations enabled)
      #   - memory_efficient: Minimal memory footprint
      #
      # Override with: uv run python runners/train.py data/performance_preset=balanced
      #
      # DEFAULT: Minimal preset (no performance features enabled)
      # This ensures safe, predictable behavior for all users.
      # Enable optimizations explicitly when needed for your use case.

      # PERFORMANCE FEATURES: DISABLED BY DEFAULT (Use presets to enable)
      # All performance features are now disabled by default for safety and compatibility.
      # Use performance presets (configs/data/performance_presets/) to enable optimizations.

      preload_images: false  # Disabled by default - use presets to enable
      load_maps: false       # Disabled by default - use presets to enable

      cache_config:
        _target_: ${dataset_config_path}.CacheConfig
        cache_transformed_tensors: false  # Disabled by default
        cache_images: false               # Disabled by default
        cache_maps: false                 # Disabled by default
        log_statistics_every_n: null      # Disabled by default
    transform: ${transforms.val_transform}
  test_dataset:
    _target_: ${dataset_path}.ValidatedOCRDataset
    config:
      _target_: ${dataset_config_path}.DatasetConfig
      image_path: ${dataset_base_path}images_val_canonical
      annotation_path: ${dataset_base_path}jsons/val.json
      enable_background_normalization: false  # Disabled for test to match training
    transform: ${transforms.test_transform}
  predict_dataset:
    _target_: ${dataset_path}.ValidatedOCRDataset
    config:
      _target_: ${dataset_config_path}.DatasetConfig
      image_path: ${dataset_base_path}images/test
      annotation_path: null
      enable_background_normalization: false  # Disabled by default for prediction
    transform: ${transforms.test_transform}

collate_fn:
  _target_: ${dataset_path}.DBCollateFN
  shrink_ratio: 0.4
  thresh_min: 0.3
  thresh_max: 0.7
