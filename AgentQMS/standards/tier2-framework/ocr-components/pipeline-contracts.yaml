ads_version: "1.0"
type: specification
agent: all
tier: 2
priority: high
validates_with: AgentQMS/standards/schemas/compliance-checker.py
compliance_status: pass
last_updated: '2026-01-20'

component: pipeline_contracts
description: Defines the canonical data structures and contracts used to pass data between pipeline stages.
role: |
  Single Source of Truth. These dataclasses/TypedDicts are the hard contracts between looseley coupled components.
  Immutability: Metadata objects (Padding, InferenceMetadata) should be treated as immutable once created.
data_contract:
  types:
    - name: PreprocessingResult
      path: PreprocessingPipeline -> InferenceOrchestrator -> ModelManager
      fields:
        - name: tensor
          type: torch.Tensor
          description: Shape (1, 3, 640, 640), normalized, float32
        - name: original_image
          type: np.ndarray
          description: Shape (H, W, 3), BGR
        - name: meta
          type: InferenceMetadata
          description: Transformation metadata for coordinate mapping
    - name: InferenceMetadata
      path: PreprocessingPipeline -> ... -> InferenceResponse
      description: Contains all logic needed to map coordinates back to the original image.
      fields:
        - name: original_size
          type: Tuple[int, int]
          description: (width, height) of raw input image
        - name: processed_size
          type: Tuple[int, int]
          description: (width, height) of image fed to model (typ. 640x640)
        - name: padding
          type: Dict[str, int]
          description: "Keys: top, bottom, left, right"
        - name: padding_position
          type: str
          description: Always 'top_left'
        - name: content_area
          type: Tuple[int, int]
          description: (width, height) of the image content within the canvas
        - name: scale
          type: float
        - name: coordinate_system
          type: str
          description: Default 'pixel'
    - name: TextRegion
      path: PostprocessingPipeline -> InferenceOrchestrator
      description: Represents a single detected text entity.
      fields:
        - name: polygon
          type: List[List[float]]
          description: shape (N, 2), coordinates in Original Image Space
        - name: confidence
          type: float
          description: 0.0 to 1.0
        - name: text
          type: Optional[str]
    - name: InferenceResponse
      path: InferenceOrchestrator -> API
      description: Final payload returned to the client.
      fields:
        - name: status
          type: str
          description: success or error
        - name: regions
          type: List[TextRegion]
        - name: meta
          type: InferenceMetadata
        - name: preview_image_base64
          type: Optional[str]
