# @package _group_
# v5.0 Standard | Purpose: Atomic DBNet Transforms (Flattened)
# ============================================================================

# Rule: No top-level 'transforms:' wrapper key
# Rule: Hardcoded or absolute interpolation for constants
train_transform:
  # Rule: _target_ at column 0 and top of block
  _target_: ocr.domains.detection.data.transforms.db_transforms.DBTransforms
  transforms:
    - _target_: albumentations.LongestMaxSize
      max_size: 640
      interpolation: ${global.default_interpolation} # Absolute Global Anchor
      p: 1.0
    - _target_: albumentations.PadIfNeeded
      min_width: 640
      min_height: 640
      border_mode: 0
      position: "top_left"
      p: 1.0
    - _target_: albumentations.HorizontalFlip
      p: 0.5
    - _target_: albumentations.Normalize
      mean: [0.485, 0.456, 0.406]
      std: [0.229, 0.224, 0.225]
  keypoint_params:
    _target_: albumentations.KeypointParams
    format: 'xy'
    remove_invisible: True
val_transform:
  _target_: ocr.domains.detection.data.transforms.db_transforms.DBTransforms
  transforms:
# BugRef: BUG-2025-001 — enforce top-left padding to simplify inverse mapping
    # Report: docs/bug_reports/BUG-2025-001_inference_padding_scaling_mismatch.md
    # Date: 2025-10-20
    - _target_: albumentations.LongestMaxSize
      max_size: 640
      interpolation: 1
      p: 1.0
    - _target_: albumentations.PadIfNeeded
      min_width: 640
      min_height: 640
      border_mode: 0
      position: "top_left"
      p: 1.0
    - _target_: albumentations.Normalize
      mean: [0.485, 0.456, 0.406]
      std: [0.229, 0.224, 0.225]
  keypoint_params:
    _target_: albumentations.KeypointParams
    format: 'xy'
    remove_invisible: True
test_transform:
  _target_: ocr.domains.detection.data.transforms.db_transforms.DBTransforms
  transforms:
# BugRef: BUG-2025-001 — enforce top-left padding to simplify inverse mapping
    # Report: docs/bug_reports/BUG-2025-001_inference_padding_scaling_mismatch.md
    # Date: 2025-10-20
    - _target_: albumentations.LongestMaxSize
      max_size: 640
      interpolation: 1
      p: 1.0
    - _target_: albumentations.PadIfNeeded
      min_width: 640
      min_height: 640
      border_mode: 0
      position: "top_left"
      p: 1.0
    - _target_: albumentations.Normalize
      mean: [0.485, 0.456, 0.406]
      std: [0.229, 0.224, 0.225]
  keypoint_params:
    _target_: albumentations.KeypointParams
    format: 'xy'
    remove_invisible: True
predict_transform:
  _target_: ocr.domains.detection.data.transforms.db_transforms.DBTransforms
  transforms:
# BugRef: BUG-2025-001 — enforce top-left padding to simplify inverse mapping
    # Report: docs/bug_reports/BUG-2025-001_inference_padding_scaling_mismatch.md
    # Date: 2025-10-20
    - _target_: albumentations.LongestMaxSize
      max_size: 640
      interpolation: 1  # cv2.INTER_LINEAR for faster processing
      p: 1.0
    - _target_: albumentations.PadIfNeeded
      min_width: 640
      min_height: 640
      border_mode: 0
      position: "top_left"
      p: 1.0
    - _target_: albumentations.Normalize
      mean: [0.485, 0.456, 0.406]
      std: [0.229, 0.224, 0.225]
  keypoint_params: null
