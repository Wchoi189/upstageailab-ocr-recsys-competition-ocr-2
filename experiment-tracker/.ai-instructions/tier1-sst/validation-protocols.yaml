---
# Tier 1 - Critical Validation Protocols
# EDS v1.0 Automated Validation Enforcement

specification_version: "1.0"
source: "EDS v1.0 Section: validation_protocols"
enforcement: "critical"
auto_block: true

validation_frequency:
  pre_commit:
    enabled: true
    hook_location: ".ai-instructions/tier4-workflows/pre-commit-hooks/"
    execution_time: "<1 second"
    blocking: true
  post_commit:
    enabled: false
    reasoning: "All validation must occur before commit"
  continuous:
    enabled: true
    command: "eds validate --continuous"
    frequency: "every 5 minutes (development mode)"
  on_demand:
    enabled: true
    command: "eds validate --experiment {experiment_id}"

validation_checks:
  eds_compliance:
    command: "python .ai-instructions/schema/compliance-checker.py {filepath}"
    validates:
      - "YAML frontmatter presence"
      - "Required fields (universal + type-specific)"
      - "Field value constraints (patterns, enums)"
      - "Prohibited content (user-oriented phrases, emoji)"
    severity: "critical"
    failure_action: "block_commit"
  naming_validation:
    command: ".ai-instructions/tier4-workflows/pre-commit-hooks/naming-validation.sh {filepath}"
    validates:
      - "YYYYMMDD_HHMM_{TYPE}_{slug}.md pattern"
      - "Prohibited patterns (ALL-CAPS, camelCase, PascalCase, spaces)"
      - "Slug format (lowercase-hyphenated, max 50 chars)"
    severity: "critical"
    failure_action: "block_commit"
  metadata_presence:
    command: ".ai-instructions/tier4-workflows/pre-commit-hooks/metadata-validation.sh {experiment_id}"
    validates:
      - ".metadata/ directory exists"
      - "At least one artifact in .metadata/ subdirectories"
      - "Correct subdirectory structure (assessments/, reports/, guides/, scripts/, artifacts/)"
    severity: "critical"
    failure_action: "block_commit"
  placement_validation:
    command: "eds_placement_validate {filepath}"
    validates:
      - "Artifact in correct .metadata/ subdirectory"
      - "Type matches subdirectory (assessment → assessments/)"
      - "No artifacts in experiment root (except README.md, state.json)"
    severity: "high"
    failure_action: "block_commit"

failure_handling:
  commit_blocked:
    enabled: true
    error_display: "detailed with fix instructions"
    exit_code: 1
  bypass_mechanism:
    enabled: false
    reasoning: "No bypass allowed - violations MUST be fixed"
    exception: "AgentQMS framework maintenance only"
  error_message_format: |
    ❌ VALIDATION FAILED: {check_name}

    File: {filepath}
    Violations:
    {violation_list}

    Fix Instructions:
    {fix_instructions}

    EDS v1.0 requires ALL validation checks to pass before commit.
    No bypass mechanism available - fix violations and retry commit.

validation_severity_levels:
  critical:
    examples:
      - "manual_artifact_creation (workflow violation)"
      - "all_caps_filename (naming violation)"
      - "missing_metadata_directory (placement violation)"
      - "missing_required_frontmatter (compliance violation)"
    action: "block_commit + display error"
    bypass: false
  high:
    examples:
      - "missing_optional_frontmatter"
      - "incorrect_subdirectory_placement"
      - "prohibited_content (user-oriented phrases)"
    action: "block_commit + display warning"
    bypass: false
  medium:
    examples:
      - "suboptimal_tag_names"
      - "verbose_prose (non-critical sections)"
    action: "display_warning"
    bypass: true
  low:
    examples:
      - "stylistic recommendations"
      - "optional field suggestions"
    action: "silent_logging"
    bypass: true

compliance_dashboard:
  command: "eds compliance-report"
  output_location: "experiment-tracker/.ai-instructions/tier4-workflows/compliance-reports/"
  format: "markdown table"
  fields:
    - "experiment_id"
    - "artifact_count"
    - "compliant_count"
    - "violation_count"
    - "critical_violations"
    - "compliance_percentage"
  sorting: "compliance_percentage ascending (worst first)"
  filters:
    - "show_only_failures"
    - "show_critical_only"
    - "show_experiment {experiment_id}"

validation_exemptions:
  README_md:
    location: "experiments/{experiment_id}/README.md"
    exemption: "User-facing documentation, does not require EDS frontmatter"
    validation: "markdown linting only"
  state_json:
    location: "experiments/{experiment_id}/state.json"
    exemption: "JSON format, CLI-managed only"
    validation: "JSON schema validation"
  legacy_artifacts:
    location: "experiments/{experiment_id}/legacy/"
    exemption: "Pre-EDS v1.0 artifacts during migration period"
    validation: "none (deprecation scheduled)"
    migration_deadline: "2025-12-31"

error_message: |
  ❌ VALIDATION FAILED

  Failed checks: {failed_check_count}/{total_check_count}

  Critical Violations:
  {critical_violations}

  High Priority Violations:
  {high_violations}

  Validation Report:
  {validation_details}

  Fix ALL violations before committing.
  Run: eds validate --experiment {experiment_id} --fix
