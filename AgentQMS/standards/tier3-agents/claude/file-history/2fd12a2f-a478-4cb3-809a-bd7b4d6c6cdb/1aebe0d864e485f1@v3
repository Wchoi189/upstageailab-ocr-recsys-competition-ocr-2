---
# Project Compass Active Session
session_id: "2026-01-08-Hydra-Config-Restructure"
status: "active"
started_date: "2026-01-08"
completed_date: null

objective: |
  Hydra Configuration Architecture Restructuring: Restructure from 107 YAML files/37
  directories to ~50 files/15 directories with domain-first organization.

implementation_plan: "docs/artifacts/implementation_plans/2026-01-08_0359_implementation_plan_hydra-config-restructuring.md"
source_walkthrough: "docs/artifacts/walkthroughs/2026-01-05_0441_Hydra-Config-Architecture-Restructuring.md"

phases:
  phase_0_discovery:
    status: "completed"
    description: "Analyze current configuration dependencies using Agent Debug Toolkit"
    tasks:
      - "✅ Map all Hydra entry points (14 entry points found across runners/)"
      - "✅ Analyze config access patterns in runners/ (120 findings)"
      - "✅ Create baseline snapshot (107 YAML files, 37 directories confirmed)"
      - "✅ Analyze component instantiation patterns (814 factory patterns found)"
      - "✅ Generate config flow documentation (train.py: 17 accesses, 10 components)"
    outputs:
      - "analysis/hydra_entry_points.json"
      - "analysis/configs_structure_before.txt"
      - "analysis/file_count_before.txt"
      - "analysis/component_factories.json"
      - "analysis/phase0_summary.md"
    findings:
      - "Main entry points: train.py, test.py, predict.py, generate_synthetic.py, train_kie.py"
      - "Config access primarily through config.get(), config.paths.*, config.model.*, config.trainer.*"
      - "Baseline: 107 YAML files / 37 directories (matches expected)"
      - "Component factories: get_encoder_by_cfg, get_decoder_by_cfg, get_head_by_cfg, get_loss_by_cfg, get_datasets_by_cfg"
      - "Config flow in train.py: 17 config accesses, 0 merge operations, 4 Hydra operations, 10 component instantiations"

  phase_1_foundation:
    status: "completed"
    completed_date: "2026-01-08"
    description: "Non-breaking foundation changes"
    tasks:
      - "✅ Create new directory structure (configs/{_foundation,domain,training,__EXTENDED__})"
      - "✅ Rename _base/ to _foundation/ (already existed as _foundation/)"
      - "✅ Create _foundation/defaults.yaml (copied from base.yaml)"
      - "✅ Update README.md (migration warning and new structure added)"
    deliverables:
      - "configs/_foundation/ directory with component files"
      - "configs/_foundation/defaults.yaml"
      - "configs/domain/ (empty, ready for Phase 2)"
      - "configs/training/ with subdirectories (callbacks, logger, profiling)"
      - "configs/__EXTENDED__/ with subdirectories (kie_variants, benchmarks, examples, experiments)"
      - "Updated configs/README.md with migration notices"
    validation:
      - "train.yaml composes successfully ✅"
      - "synthetic.yaml composes successfully ✅"
      - "test.yaml and predict.yaml have pre-existing defaults ordering issues (not Phase 1 related)"
    notes: |
      Phase 1 completed successfully. All non-breaking foundation changes in place.
      Directory structure created and ready for Phase 2 domain unification.
      Pre-existing issues in test.yaml and predict.yaml noted for future resolution.

  phase_2_domain:
    status: "completed"
    completed_date: "2026-01-08"
    description: "Domain unification"
    tasks:
      - "✅ Create configs/domain/detection.yaml (text detection with DBNet)"
      - "✅ Create configs/domain/recognition.yaml (text recognition with PARSeq)"
      - "✅ Create configs/domain/kie.yaml (key information extraction with LayoutLMv3)"
      - "✅ Create configs/domain/layout.yaml (layout analysis)"
      - "✅ Verify all domain configs compose correctly"
    deliverables:
      - "configs/domain/detection.yaml"
      - "configs/domain/recognition.yaml"
      - "configs/domain/kie.yaml"
      - "configs/domain/layout.yaml"
    validation:
      - "✅ domain=detection composes successfully (task: detection)"
      - "✅ domain=recognition composes successfully (task: recognition)"
      - "✅ domain=kie composes successfully (task: kie)"
      - "✅ domain=layout composes successfully (task: layout_analysis)"
    notes: |
      All domain configs created and tested successfully.
      Each domain config uses Hydra defaults composition to unify model and data settings.
      Domain switching enabled via CLI: python runners/train.py +domain=X

  phase_3_entrypoints:
    status: "pending"
    description: "Entry point simplification"
    tasks:
      - "Update train.yaml with domain composition"
      - "Rename test.yaml to eval.yaml"
      - "Archive KIE variant configs"

  phase_4_infrastructure:
    status: "pending"
    description: "Infrastructure reorganization"
    tasks:
      - "Move training infrastructure (callbacks, logger)"
      - "Merge UI directories"
      - "Move examples and benchmarks"

  phase_5_scripts:
    status: "pending"
    description: "Script updates"
    tasks:
      - "Find all Hydra entry points"
      - "Update runner scripts"
      - "Update test/evaluation scripts"
      - "Update performance benchmark scripts"

  phase_6_verification:
    status: "pending"
    description: "Verification and validation"
    tasks:
      - "Hydra composition tests"
      - "Smoke test training"
      - "Validate with AgentQMS"
      - "Compare before/after metrics"

  phase_7_documentation:
    status: "pending"
    description: "Documentation and cleanup"
    tasks:
      - "Update main documentation"
      - "Create migration cheatsheet"
      - "Remove old base.yaml"

  phase_8_cicd:
    status: "pending"
    description: "CI/CD updates"
    tasks:
      - "Update GitHub Actions"
      - "Update Docker configs"

current_task: "Phase 3: Entry Point Simplification"

notes: |
  Session handover documentation moved to: project_compass/session_handover.md

  Phase 0 Complete ✅ - All discovery tasks finished using MCP tools.
  Phase 1 Complete ✅ - Foundation directory structure created, README updated.
  Phase 2 Complete ✅ - All domain configs created and validated.
  Ready to begin Phase 3 (entry point simplification) - REQUIRES STAKEHOLDER APPROVAL.

references:
  - "AGENTS.yaml - Root-level project resource index"
  - "AgentQMS/standards/workflow_standards.yaml - Development patterns"
  - "AgentQMS/standards/naming_standards.yaml - Naming conventions"
  - "AgentQMS/standards/artifact_standards.yaml - Artifact templates"
  - "project_compass/AI_ENTRYPOINT.md - Session lifecycle protocol"
  - "analysis/phase0_summary.md - Complete Phase 0 findings"
  - "docs/artifacts/implementation_plans/2026-01-08_0359_implementation_plan_hydra-config-restructuring.md"

blockers: []

notes:
  - "Requires stakeholder approval before execution"
  - "Breaking changes to config entry points"
  - "Git branch: refactor/hydra (already exists)"

tools_required:
  - "Agent Debug Toolkit (ADT)"
  - "AgentQMS CLI"
  - "uv package manager"

success_criteria:
  - "Total YAML files < 60"
  - "Directory count < 20"
  - "Root-level configs ≤ 5"
  - "All compositions pass"
  - "Smoke tests pass"
  - "AgentQMS validation passes"
