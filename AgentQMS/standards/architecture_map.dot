digraph AgentQMS_Architecture {
  rankdir=TB;
  node [shape=box, style=rounded, fontname="Arial"];
  edge [fontname="Arial", fontsize=10];
  compound=true;

  subgraph cluster_tier1 {
    label="Constitution (Tier 1)";
    style=filled;
    color="#FFE6E6";
    fontsize=14;
    fontname="Arial Bold";

    "SC-001" [label="SC-001\nFile and artifact naming conventions ...", penwidth=2, color=red];
    "SC-002" [label="SC-002\nArtifact type system with plugin-base...", penwidth=2, color=red];
    "SC-003" [label="SC-003\nUnified artifact naming and placement...", penwidth=2, color=red];
    "SC-004" [label="SC-004", penwidth=2, color=red];
    "SC-005" [label="SC-005\nSingle source of truth for artifact f...", penwidth=2, color=red];
    "SC-006" [label="SC-006", penwidth=2, color=red];
    "SC-007" [label="SC-007", penwidth=2, color=red];
    "SC-008" [label="SC-008", penwidth=2, color=red];
    "SC-009" [label="SC-009", penwidth=2, color=red];
    "SC-010" [label="SC-010", penwidth=2, color=red];
    "manifest" [label="manifest", penwidth=2, color=red];
  }

  subgraph cluster_tier2 {
    label="Framework (Tier 2)";
    style=filled;
    color="#CCCCCC";
    fontsize=14;
    fontname="Arial Bold";

    subgraph cluster_core_infra {
      label="Core Infrastructure";
      style=filled;
      color="#E6F0FF";
      fontsize=11;

      "FW-001" [label="FW-001\nDefines the architecture, communicati...", penwidth=2, color=red];
      "FW-002" [label="FW-002\nProtocol for handling runtime telemet...", penwidth=2, color=red];
      "FW-004" [label="FW-004", penwidth=2, color=red];
      "FW-030" [label="FW-030", penwidth=1.5, color=orange];
    }

    subgraph cluster_ocr_engine {
      label="OCR Data Pipeline";
      style=filled;
      color="#E6FFF0";
      fontsize=11;

      "FW-012" [label="FW-012\nHandles mapping between resized/padde...", penwidth=1.5, color=orange];
      "FW-020" [label="FW-020\nHandles loading and validation of inp...", penwidth=1.5, color=orange];
      "FW-023" [label="FW-023\nManages the lifecycle of models (dete...", penwidth=1.5, color=orange];
      "FW-024" [label="FW-024\nThe central controller for the OCR in...", penwidth=1.5, color=orange];
      "FW-026" [label="FW-026\nDefines the canonical data structures...", penwidth=1.5, color=orange];
      "FW-027" [label="FW-027\nDecodes raw model output into structu...", penwidth=1.5, color=orange];
      "FW-028" [label="FW-028\nPrepares raw images for inference.", penwidth=1.5, color=orange];
    }

    subgraph cluster_configuration {
      label="Configuration & Hydra";
      style=filled;
      color="#FFF4E6";
      fontsize=11;

      "FW-008" [label="FW-008", penwidth=1.5, color=orange];
      "FW-009" [label="FW-009"];
      "FW-010" [label="FW-010", penwidth=1.5, color=orange];
      "FW-011" [label="FW-011\nStandards for safely handling OmegaCo...", penwidth=2, color=red];
      "FW-017" [label="FW-017", penwidth=2, color=red];
      "FW-019" [label="FW-019\nCritical configuration rules for Hydr...", penwidth=2, color=red];
    }

    subgraph cluster_validation {
      label="Safety & Validation";
      style=filled;
      color="#FFE6F0";
      fontsize=11;

      "FW-029" [label="FW-029", penwidth=1.5, color=orange];
      "FW-033" [label="FW-033", penwidth=1.5, color=orange];
      "FW-037" [label="FW-037\nKeyword mappings for context bundle t...", penwidth=1.5, color=orange];
    }

    subgraph cluster_patterns {
      label="Patterns & Design";
      style=filled;
      color="#F0E6FF";
      fontsize=11;

      "FW-003" [label="FW-003\nProhibited patterns with enforcement ...", penwidth=1.5, color=orange];
      "FW-007" [label="FW-007\nDefines the interface contracts for O...", penwidth=1.5, color=orange];
      "FW-018" [label="FW-018\nDesign patterns, anti-patterns, and d...", penwidth=1.5, color=orange];
      "FW-035" [label="FW-035\nDraws detected bounding boxes and cla...", penwidth=1.5, color=orange];
    }

    subgraph cluster_tooling {
      label="Tooling & DevEx";
      style=filled;
      color="#E6E6E6";
      fontsize=11;

      "FW-015" [label="FW-015", penwidth=1.5, color=orange];
      "FW-022" [label="FW-022", penwidth=1.5, color=orange];
      "FW-025" [label="FW-025"];
      "FW-036" [label="FW-036", penwidth=1.5, color=orange];
    }

  }

  subgraph cluster_tier3 {
    label="Agents (Tier 3)";
    style=filled;
    color="#E6FFE6";
    fontsize=14;
    fontname="Arial Bold";

    "AG-001" [label="AG-001\nAutomated criteria for identifying un..."];
    "AG-002" [label="AG-002", penwidth=2, color=red];
    "AG-003" [label="AG-003", penwidth=1.5, color=orange];
    "AG-004" [label="AG-004", penwidth=2, color=red];
    "AG-005" [label="AG-005", penwidth=1.5, color=orange];
    "AG-006" [label="AG-006\nOllama model catalog with specificati...", penwidth=1.5, color=orange];
  }

  subgraph cluster_tier4 {
    label="Workflows (Tier 4)";
    style=filled;
    color="#FFF9E6";
    fontsize=14;
    fontname="Arial Bold";

    "WF-001" [label="WF-001", penwidth=1.5, color=orange];
    "WF-002" [label="WF-002\nRuntime middleware policies enforced ...", penwidth=1.5, color=orange];
  }

  subgraph cluster_legend {
    label="Legend";
    style=filled;
    color="#F5F5F5";
    fontsize=12;
    fontname="Arial Bold";

    legend_critical [label="Critical (Red)", penwidth=2, color=red, shape=box, style=rounded];
    legend_high [label="High Priority (Orange)", penwidth=1.5, color=orange, shape=box, style=rounded];
    legend_dep [label="Dependency\n(Solid Arrow)", shape=plaintext];
    legend_gov [label="Governance\n(Dashed Arrow)", shape=plaintext];

    legend_critical -> legend_high [style=invis];
    legend_high -> legend_dep [style=invis];
    legend_dep -> legend_gov [style=invis];
  }

  // Declared Dependencies (from registry.yaml)
  "SC-001" -> "SC-002" [color=blue, penwidth=1.5];
  "SC-007" -> "AG-006" [color=blue, penwidth=1.5];

  // Governance Mappings (Constitutional laws enforce lower tiers)
  "SC-002" -> "FW-026" [style=dashed, color="#666666", penwidth=1.0];
  "SC-007" -> "FW-001" [style=dashed, color="#666666", penwidth=1.0];
  "SC-008" -> "FW-029" [style=dashed, color="#666666", penwidth=1.0];
  "SC-008" -> "FW-033" [style=dashed, color="#666666", penwidth=1.0];
  "SC-001" -> "AG-002" [style=dashed, color="#666666", penwidth=1.0];
  "SC-007" -> "AG-006" [style=dashed, color="#666666", penwidth=1.0];
  "FW-007" -> "AG-002" [style=dashed, color="#666666", penwidth=1.0];

  // Architectural Dependencies (Framework consumed by Agents/Workflows)
  "FW-026" -> "FW-027" [color="#0066CC", penwidth=1.5];
  "FW-026" -> "FW-028" [color="#0066CC", penwidth=1.5];
  "FW-026" -> "FW-012" [color="#0066CC", penwidth=1.5];
  "FW-001" -> "FW-002" [color="#0066CC", penwidth=1.5];
  "FW-019" -> "FW-017" [color="#0066CC", penwidth=1.5];
  "FW-011" -> "FW-019" [color="#0066CC", penwidth=1.5];
  "FW-030" -> "FW-029" [color="#0066CC", penwidth=1.5];
  "FW-001" -> "AG-002" [color="#0066CC", penwidth=1.5];
  "FW-001" -> "AG-003" [color="#0066CC", penwidth=1.5];
  "AG-002" -> "WF-001" [color="#0066CC", penwidth=1.5];
  "AG-004" -> "WF-001" [color="#0066CC", penwidth=1.5];
  "FW-002" -> "WF-002" [color="#0066CC", penwidth=1.5];

  // Critical Path Chain
  "SC-002" -> "FW-026" [color=red, penwidth=2.5, label="CRITICAL"];
  "FW-026" -> "FW-001" [color=red, penwidth=2.5, label="CRITICAL"];
  "FW-001" -> "FW-011" [color=red, penwidth=2.5, label="CRITICAL"];
  "FW-011" -> "AG-002" [color=red, penwidth=2.5, label="CRITICAL"];
  "AG-002" -> "WF-001" [color=red, penwidth=2.5, label="CRITICAL"];
}