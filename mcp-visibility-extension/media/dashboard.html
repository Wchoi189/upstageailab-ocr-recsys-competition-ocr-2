<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy"
        content="default-src 'none'; style-src 'unsafe-inline' vscode-resource: {{styleUri}}; script-src 'nonce-{{nonce}}' {{scriptUri}};">
    <title>MCP Visibility Dashboard</title>
    <link rel="stylesheet" type="text/css" href="{{styleUri}}">
</head>

<body>
    <div class="header-row">
        <h1>
            <span>üìä AgentQMS Visibility</span>
            <button class="refresh-btn" onclick="refresh()">‚Üª Refresh</button>
        </h1>
        <div class="health-status">
            <div class="health-indicator disconnected" id="healthIndicator"></div>
            <span id="healthText">Connecting...</span>
        </div>
    </div>
    <div class="last-update" id="lastUpdate">Last update: Never</div>

    <!-- Tab Navigation -->
    <div class="tab-nav">
        <button class="tab-btn active" data-tab="overview">üìä Overview</button>
        <button class="tab-btn" data-tab="tools">üîß Tools</button>
        <button class="tab-btn" data-tab="policies">üìú Policies</button>
        <button class="tab-btn" data-tab="bundles">üì¶ Bundles</button>
        <button class="tab-btn" data-tab="settings">‚öôÔ∏è Settings</button>
    </div>

    <!-- Overview Tab -->
    <div class="tab-content active" id="tab-overview">
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value info" id="total">0</div>
                <div class="stat-label">Total Calls</div>
            </div>
            <div class="stat-card">
                <div class="stat-value success" id="success">0</div>
                <div class="stat-label">Successful</div>
            </div>
            <div class="stat-card">
                <div class="stat-value error" id="errors">0</div>
                <div class="stat-label">Errors</div>
            </div>
            <div class="stat-card">
                <div class="stat-value warning" id="violations">0</div>
                <div class="stat-label">Policy Violations</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="avgDuration">0</div>
                <div class="stat-label">Avg Duration (ms)</div>
            </div>
            <div class="stat-card">
                <div class="stat-value info" id="sessionInput">0</div>
                <div class="stat-label">Session Input (tok)</div>
            </div>
            <div class="stat-card">
                <div class="stat-value info" id="sessionOutput">0</div>
                <div class="stat-label">Session Output (tok)</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="sessionTotal">0</div>
                <div class="stat-label">Session Total (tok)</div>
            </div>
        </div>

        <div class="section" id="violations-section" style="display: none;">
            <h2 class="section-title">‚ö†Ô∏è Recent Policy Violations</h2>
            <div class="violations-panel" id="violations-list"></div>
        </div>

        <div class="section">
            <h2 class="section-title">üìã Recent Tool Calls</h2>
            <div class="toolbar">
                <input type="search" class="search-input" placeholder="Search tool calls..." id="searchInput">
                <select class="filter-select" id="statusFilter">
                    <option value="all">All Statuses</option>
                    <option value="success">Success</option>
                    <option value="error">Error</option>
                    <option value="policy_violation">Violations</option>
                </select>
                <button class="toolbar-btn" onclick="exportData()">üì• Export</button>
            </div>
            <div id="calls-container">
                <div class="empty-state">
                    <div class="empty-state-icon">üìã</div>
                    <div>No telemetry data yet. Make some MCP tool calls!</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tools Tab -->
    <div class="tab-content" id="tab-tools">
        <div class="section">
            <h2 class="section-title">üîß Tool Analytics</h2>
            <div class="toolbar">
                <input type="search" class="search-input" placeholder="Search tools..." id="toolSearch">
                <select class="filter-select" id="toolSortBy">
                    <option value="usage">Sort by Usage</option>
                    <option value="name">Sort by Name</option>
                    <option value="avgDuration">Sort by Avg Duration</option>
                </select>
            </div>
            <div class="tools-grid" id="tools-grid">
                <div class="empty-state">
                    <div class="empty-state-icon">üîß</div>
                    <div>No tool data available</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Policies Tab (Merged with Violations) -->
    <div class="tab-content" id="tab-policies">
        <!-- Violations Section -->
        <div class="section">
            <h2 class="section-title">‚ö†Ô∏è Compliance Status</h2>
            <div id="violations-detailed">
                <div class="empty-state">
                    <div class="empty-state-icon">‚úì</div>
                    <div>No policy violations found</div>
                </div>
            </div>
        </div>

        <!-- Standards Section -->
        <div class="section">
            <h2 class="section-title">üìú Active Standards & Policies</h2>
            <div class="toolbar">
                <input type="search" class="search-input" placeholder="Search policies..." id="policySearch">
            </div>
            <div id="policies-container">
                <div class="empty-state">
                    <div class="empty-state-icon">üìú</div>
                    <div>No policies found</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bundles Tab -->
    <div class="tab-content" id="tab-bundles">
        <div class="section">
            <h2 class="section-title">üì¶ Context Bundles</h2>
            <div class="toolbar">
                <input type="search" class="search-input" placeholder="Search bundles..." id="bundleSearch">
            </div>
            <div id="bundles-container">
                <div class="empty-state">
                    <div class="empty-state-icon">üì¶</div>
                    <div>No bundles found</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Tab -->
    <div class="tab-content" id="tab-settings">
        <div class="section">
            <h2 class="section-title">‚öôÔ∏è Dashboard Settings</h2>
            <div class="settings-panel">
                <div class="setting-item">
                    <div>
                        <div class="setting-label">Auto Refresh</div>
                        <div class="setting-description">Automatically refresh data when telemetry updates</div>
                    </div>
                    <div class="toggle-switch on" onclick="toggleSetting(this, 'autoRefresh')">
                        <div class="toggle-knob"></div>
                    </div>
                </div>
                <div class="setting-item">
                    <div>
                        <div class="setting-label">Show Notifications</div>
                        <div class="setting-description">Show notifications for errors and violations</div>
                    </div>
                    <div class="toggle-switch on" onclick="toggleSetting(this, 'notifications')">
                        <div class="toggle-knob"></div>
                    </div>
                </div>
                <div class="setting-item">
                    <div>
                        <div class="setting-label">Compact View</div>
                        <div class="setting-description">Use compact layout for tables</div>
                    </div>
                    <div class="toggle-switch" onclick="toggleSetting(this, 'compactView')">
                        <div class="toggle-knob"></div>
                    </div>
                </div>
            </div>

            <div class="settings-panel">
                <h3 style="margin-bottom: 12px;">Data Management</h3>
                <div class="setting-item">
                    <div>
                        <div class="setting-label">Max Events Displayed</div>
                        <div class="setting-description">Currently showing last 100 events</div>
                    </div>
                    <select class="filter-select" onchange="updateMaxEvents(this.value)">
                        <option value="50">50</option>
                        <option value="100" selected>100</option>
                        <option value="200">200</option>
                        <option value="500">500</option>
                    </select>
                </div>
                <div class="setting-item">
                    <div>
                        <div class="setting-label">Clear All Data</div>
                        <div class="setting-description">Reset all cached telemetry data</div>
                    </div>
                    <button class="toolbar-btn" onclick="clearData()">Clear</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Dialog -->
    <div class="modal-overlay" id="modal">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <div class="modal-title" id="modalTitle">Tool Call Details</div>
                <button class="modal-close" onclick="closeModal()">√ó</button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Content will be populated dynamically -->
            </div>
        </div>
    </div>

    <script nonce="{{nonce}}" src="{{scriptUri}}"></script>
</body>
</html>
