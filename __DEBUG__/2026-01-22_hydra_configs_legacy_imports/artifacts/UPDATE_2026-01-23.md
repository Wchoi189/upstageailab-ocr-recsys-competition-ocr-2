# Update Summary: Duplicate File Detection Guide

**Date**: 2026-01-23
**Update Type**: New artifact addition
**Source**: Follow-up conversation snippets

---

## What Was Added

### New Artifact

**File**: `artifacts/refactoring_patterns/duplicate_file_detection.md`

**Content**: Comprehensive guide covering:
- Split-brain scenarios and duplicate file detection
- Shadow import testing technique
- The "Kill-Duplicate" consolidation plan
- Doc-Sync audit tooling for AgentQMS compliance
- Prevention strategies and best practices

**Size**: ~550 lines of structured documentation

---

## Why This Matters

This guide addresses a critical manifestation of the **Ghost Code phenomenon** discovered during the debugging session. Duplicate files create "split-brain scenarios" where:

1. Updates to one file don't affect runtime behavior
2. AI agents get trapped fixing the "wrong" file repeatedly
3. Python treats duplicate files as separate modules
4. Debugging becomes nearly impossible

**Real Example from Session**:
- `ocr/core/utils/config_utils.py` (source of truth)
- `ocr/core/lightning/utils/config_utils.py` (duplicate)
- Shadow import test showed: `module1 is module2` → `False` (CRITICAL!)

---

## Integration with Existing Artifacts

### Updated Files

1. **`artifacts/README.md`**:
   - Added to refactoring patterns section
   - Added new use case: "Detecting and Fixing Duplicate Files"
   - Cross-referenced with related guides

### Relationship to Existing Content

**Complements**:
- `shim_antipatterns_guide.md` - Both address technical debt patterns
- `migration_guard_implementation.md` - Duplicate detection is part of validation
- `adt_usage_patterns.md` - Uses AST-grep for structural analysis

**Extends**:
- Ghost code phenomenon from `01_initial_analysis.md`
- Pain points from `debugging_pain_points.md`
- Adds Doc-Sync tooling for AgentQMS compliance

---

## Key Techniques Documented

### 1. Shadow Import Test

**Purpose**: Prove duplicate files are treated as separate modules

```bash
python -c "import module1 as m1; import module2 as m2; print(f'Same? {m1 is m2}')"
```

**Critical**: If `False`, you have a split-brain scenario

### 2. The "Kill-Duplicate" Plan

**4-Phase Process**:
1. **Identification** - Find and confirm duplicates
2. **Consolidation** - Merge logic into source of truth
3. **Deletion** - Remove duplicate (no `.bak` files!)
4. **Prevention** - Add lint rules and documentation

### 3. Doc-Sync Audit Tool

**Purpose**: Ensure code complies with AgentQMS standards

**Implementation**: `AgentQMS/tools/compliance/doc_sync_audit.py`

**Features**:
- Parses standards YAML for bad patterns
- Uses AST-grep for structural search
- Fails build if violations found in compliant code

---

## Practical Applications

### For Current Debugging Session

1. **Immediate**: Check for duplicate `config_utils.py` files
2. **Run shadow import test** to confirm split-brain
3. **Consolidate** using provided diff
4. **Delete duplicate** and update imports

### For Future Refactoring

1. **Pre-commit hook** to detect duplicate filenames
2. **AST-grep rules** to catch imports from deprecated locations
3. **Architecture documentation** to prevent utility layer blur
4. **Doc-Sync audits** in CI/CD pipeline

---

## Where to Find It

### In Artifacts Directory

```
artifacts/
├── refactoring_patterns/
│   ├── shim_antipatterns_guide.md
│   └── duplicate_file_detection.md  ← NEW
```

### Quick Access

- **From README**: See "Refactoring Patterns" section
- **Use Case**: "Detecting and Fixing Duplicate Files"
- **Related**: Ghost code phenomenon in `01_initial_analysis.md`

---

## Next Steps

### Recommended Actions

1. **Review the guide**: Understand split-brain scenarios
2. **Run shadow import test**: Check for duplicates in your codebase
3. **Implement Doc-Sync**: Add compliance auditing to CI/CD
4. **Update architecture docs**: Clarify utility placement rules

### Integration Opportunities

1. **Add to migration_guard.py**: Include duplicate detection
2. **Create pre-commit hook**: Prevent duplicate commits
3. **Enhance master_audit.py**: Report duplicate files
4. **Document in AgentQMS**: Add to refactoring standards

---

## Summary

**Added**: 1 new comprehensive guide (550+ lines)
**Updated**: 1 existing file (README.md)
**Focus**: Duplicate file detection and split-brain scenarios
**Value**: Prevents ghost code debugging cycles
**Integration**: Fully cross-referenced with existing artifacts

The artifact collection now contains **9 total artifacts** covering the complete spectrum of Hydra refactoring, legacy import management, and systematic debugging strategies.
