---
# Tier 1 - Critical Lifecycle Rules
# EDS v1.0 Experiment State Management

specification_version: "1.0"
source: "EDS v1.0 Section: lifecycle_management"
enforcement: "high"
auto_block: false

lifecycle_states:
  active:
    description: "Experiment actively being developed"
    allowed_modifications: "unrestricted"
    artifact_creation: "allowed"
    artifact_deletion: "allowed"
    artifact_updates: "allowed"
    state_transitions: ["complete", "deprecated"]
  complete:
    description: "Experiment finished, results documented"
    allowed_modifications: "corrections only"
    artifact_creation: "prohibited (except corrections)"
    artifact_deletion: "prohibited"
    artifact_updates: "minor corrections only"
    state_transitions: ["deprecated"]
  deprecated:
    description: "Experiment superseded by newer work"
    allowed_modifications: "none"
    artifact_creation: "prohibited"
    artifact_deletion: "automated after 30 days"
    artifact_updates: "prohibited"
    state_transitions: []
    retention_policy: "30 days before deletion"
  draft:
    description: "Initial artifact creation state"
    allowed_modifications: "unrestricted"
    artifact_creation: "n/a (artifact-level status)"
    artifact_deletion: "allowed"
    artifact_updates: "unrestricted"
    state_transitions: ["active", "complete"]

state_transition_rules:
  active_to_complete:
    requirements:
      - "At least one report artifact with metrics"
      - "All assessments marked complete"
      - "experiment_manifest status updated"
    command: "eds mark-complete --experiment {experiment_id}"
    validation: "automated"
  complete_to_deprecated:
    requirements:
      - "Superseded by newer experiment"
      - "Migration path documented"
      - "superseded_by field populated"
    command: "eds mark-deprecated --experiment {experiment_id} --superseded-by {new_experiment_id}"
    validation: "manual approval required"
  deprecated_retention:
    duration: "30 days"
    notification: "7 days before deletion"
    deletion_command: "eds delete-experiment --experiment {experiment_id}"
    backup_requirement: "archived to experiment-archive/ before deletion"

supersession_tracking:
  superseded_by:
    required_when: "status: deprecated"
    format: "experiment_id"
    example: "20251218_120000_improved_approach"
    validation: "referenced experiment must exist"
  supersedes:
    optional: true
    format: "array of experiment_ids"
    example: ["20251217_024343_image_enhancements", "20251215_100000_baseline"]
    usage: "Track lineage of experiment evolution"

artifact_status_independence:
  reasoning: "Artifacts can be draft/active/complete/deprecated independently of experiment"
  example: |
    Experiment: active
      Assessment 1: complete (finished analysis)
      Assessment 2: active (in progress)
      Report 1: draft (not yet finalized)
  rules:
    - "Artifact status does NOT inherit from experiment status"
    - "Experiment completion requires all critical artifacts complete"
    - "Deprecated experiment has all artifacts deprecated"

validation_command: "eds_lifecycle_validate"
error_message: |
  ⚠️  Lifecycle violation detected

  Experiment: {experiment_id}
  Current status: {current_status}
  Attempted action: {action}

  Violation: {violation_description}

  Lifecycle Rules:
  - active: unrestricted modifications
  - complete: corrections only
  - deprecated: read-only, 30-day retention

  State Transitions:
  - active → complete (requires all assessments complete, at least one report)
  - complete → deprecated (requires superseded_by field)

  Fix: {suggested_fix}
